<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: commands/helpers.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: commands/helpers.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const discord = require('discord.js');

/**
 * @description gets the current date in a 12 hour format
 */
module.exports.timestamp = () =>new Date().toLocaleTimeString([],{hour: '2-digit', minute:'2-digit'})
/**
 * @description It's just a fancier console.log
 * @param {Object} msg 
 * @param {String} text
 */
module.exports.log = (msg = null, text) =>
{
    if(!msg) console.log(`${'[Monkey]'.bold.green} ${this.timestamp()} ${text}`)
    else console.log(`${'[Monkey]'.bold.green} ${`${msg.guild.name}`.italic.cyan} ${this.timestamp()} ${text}`)
}
/**
 * @description Bot specific permissions
 */
module.exports.Perms = class Perms
{
    constructor(msg){this.msg = msg;}

    // All functions return a bool for if the bot has permissions
    /**
     * @description Returns boolean if the user is an admin
     * @returns {boolean} 
     */
    admin(){return this.msg.member.guild.me.hasPermission(['ADMINISTRATOR'])}
    /**
     * @description Returns boolean if the user is allowed to delete
     * messages, reactions, pin messages ...
     * @returns {boolean} 
     */
    del(){return this.msg.member.guild.me.hasPermission(['MANAGE_MESSAGES'])}
    /**
     * @description Returns boolean if the user is allowed to send files
     * @returns {boolean} 
     */
    attach(){return this.msg.member.guild.me.hasPermission(['ATTACH_FILES'])}
    /**
     * @description Returns boolean if the user is allowed to send messages
     * @returns {boolean} 
     */
    /**
     * @description Returns boolean if the user is allowed to add reactions to a message
     * @returns {boolean} 
     */
    react(){return this.msg.member.hasPermission('ADD_REACTIONS')}
    msg(){return this.msg.member.guild.me.hasPermission(['SEND_MESSAGES'])}
    /**
     * @description Returns boolean if the user is allowed to view the current channel
     * @returns {boolean} 
     */
    viewchat(){return this.msg.member.guild.me.hasPermission(['VIEW_CHANNEL'])}
    /**
     * @description Returns boolean if the user is allowed to speak
     * @returns {boolean} 
     */
    speak(){return this.msg.member.guild.me.hasPermission(['SPEAK'])}
}

/**
 * @description User specific permissions
 */
module.exports.UserPerms = class UserPerms
{
    /**
     * 
     * @param {Object} msg 
     */
    constructor(msg){this.msg = msg;}

    /**
     * @description Returns boolean if the user is an admin
     * @returns {boolean} 
     */
    admin(){return this.msg.member.hasPermission(['ADMINISTRATOR'])}
    /**
     * @description Returns boolean if the user is allowed to delete
     * messages, reactions, pin messages ...
     * @returns {boolean} 
     */
    del(){return this.msg.member.hasPermission(['MANAGE_MESSAGES'])}
    /**
     * @description Returns boolean if the user is allowed to send files
     * @returns {boolean} 
     */
    attach(){return this.msg.member.hasPermission(['ATTACH_FILES'])}
    /**
     * @description Returns boolean if the user is allowed to add reactions to a message
     * @returns {boolean} 
     */
    react(){return this.msg.member.hasPermission('ADD_REACTIONS')}
    /**
     * @description Returns boolean if the user is allowed to send messages
     * @returns {boolean} 
     */
    msg(){return this.msg.member.hasPermission(['SEND_MESSAGES'])}
    /**
     * @description Returns boolean if the user is allowed to view the current channel
     * @returns {boolean} 
     */
    viewchat(){return this.msg.member.hasPermission(['VIEW_CHANNEL'])}
    /**
     * @description Returns boolean if the user is allowed to speak
     * @returns {boolean} 
     */
    speak(){return this.msg.member.hasPermission(['SPEAK'])}
}

 /**
  * @returns {String} Random monkey text from array
  * @TODO Move noises to mongodb
  */
module.exports.randomnoise = () =>
{
    const noise = [
        'OOOOOOOOOO OOOO AHHHHHHH AH',
        'OOOOOO',
        'MMMM OOOO OOO AAAA AAAH',
        'AAAAAAAAAAAAAAAAAAAAAAAAAAA',
        '*Monkey noises*',
        'AAAA OOOO OO AA OOOOooooOO',
        'AAA OOOOOOO',
        'OOOOOO AAAAAAH AHHHHHHHHHHHHHHHHHHH',
        'EEK EEEEK',
        'HOOO HOOO HOOOOOO',
        'OOOOO OOOOO OOOO',
        'OOOK OOOO HOOOO'
    ]
    const r = Math.floor(Math.random() * noise.length)
    return noise[r];
}

 /**
  * @param {Error} e Error message
  * @param {Object} msg Discord API message manager
  * @description Sends an error message into chat
  */
module.exports.err = (e, msg) =>
{
    const perms = new this.Perms(msg);
    const title = perms.del() ? "Click the X to close this message" : "Something happened ..."
    const embed = new discord.MessageEmbed()
    .setTitle(title)
    .setDescription(`\`\`\`${e}\`\`\``)
    .setColor(process.env.BOT_COLOR_ERR)
    .setFooter(`${msg.author.username}#${msg.author.discriminator}`, `${msg.author.avatarURL()}`)
    .setTimestamp();
    if(msg.channel == undefined) return;
    else
    {
        msg.channel.send(embed).then(thismsg=>{this.delreact(thismsg)})
    }
}

 /**
  * @description Adds a reaction to a given message and after x amount of ms will delete the message
  * @param {Object} msg Discord API message manager
  */
module.exports.delreact = (msg) =>
{
    const perms = new this.Perms(msg);
    if(perms.del()) return;     // Check to see if we have manage_messages
    msg.react('❌');                                                                                 // React to our msg with X
    const filter = (reaction, user) => '❌' === reaction.emoji.name &amp;&amp; user.id === msg.author.id;    // Some filter shit ??
    msg.awaitReactions(filter, {time: 5000}).then(result=>
    {
        if(msg.deleted) return;
        if(result.get('❌').count-1 >= 1) msg.delete();
        else msg.reactions.removeAll().catch();
    })
    .catch(e=>
    {
        console.log(e)
    })
}


 /**
  * @param {object} msg Discord API message manager
  * @param {String} desc Text to send to the user
  * @description Basic message embed
  */
module.exports.sendmessage = (msg, desc) => {
    const embed = new discord.MessageEmbed()
    .setAuthor(this.randomnoise(), msg.client.user.displayAvatarURL())
    .setColor(process.env.BOT_COLOR)
    .setTitle(`${desc}`)
    .setTimestamp()
    .setFooter(`${msg.author.username}#${msg.author.discriminator}`, `${msg.author.avatarURL()}`);
    msg.channel.send(embed);
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Perms.html">Perms</a></li><li><a href="UserPerms.html">UserPerms</a></li></ul><h3>Global</h3><ul><li><a href="global.html#bcommand">bcommand</a></li><li><a href="global.html#colors">colors</a></li><li><a href="global.html#db_connect">db_connect</a></li><li><a href="global.html#delete">delete</a></li><li><a href="global.html#delreact">delreact</a></li><li><a href="global.html#err">err</a></li><li><a href="global.html#getmonkey">getmonkey</a></li><li><a href="global.html#google_results">google_results</a></li><li><a href="global.html#invite">invite</a></li><li><a href="global.html#log">log</a></li><li><a href="global.html#monkey">monkey</a></li><li><a href="global.html#monkeygoogle">monkeygoogle</a></li><li><a href="global.html#monkeyreddit">monkeyreddit</a></li><li><a href="global.html#quote_reached">quote_reached</a></li><li><a href="global.html#randomnoise">randomnoise</a></li><li><a href="global.html#Reaction_Result">Reaction_Result</a></li><li><a href="global.html#reactions">reactions</a></li><li><a href="global.html#sendMessage">sendMessage</a></li><li><a href="global.html#sendmessage">sendmessage</a></li><li><a href="global.html#timestamp">timestamp</a></li><li><a href="global.html#vote">vote</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.5</a> on Wed Aug 26 2020 14:35:31 GMT+1000 (Australian Eastern Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
